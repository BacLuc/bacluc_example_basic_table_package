## Example of using Basic Table Package
This is an example of how to extend Basic Table Packge,
to provide CRUD functionality for SQL Tables.  

How to use:
Create a new Concrete5 package and put this code inside.
Then change the Code that it matches you needs.

1. Change the Package Controller [controller.php](controller.php)
There are TODO's where you have to change the file. Change the namespace
(Concrete\Package stays, then you have to use the modified PSR4 standard Concrete5 uses:
The namespace is similiar to the folder name of you package, it starts with uppercase, then continues with
lowercase till the first underscore(\_). You skip the underscore, but the next letter is uppercase again.
Then there are some special folders which have a special namespace name:  
packages/your_package_name/themes -> Concrete\YourPackagename\Theme  
packages/your_package_name/blocks -> Concrete\YourPackagename\Block    
....  
)  
Its is best to uncomment the line which installs the BlockType as long as you haven't implemented the BlockType 
2.   Put the Entities in the src Folder you need
Currently, there is a Example Class which just has any FieldType currently supportet by FieldTypes
Copy it, change it according to you needs. Important: Classname and Filename have to be the same.
Inside the src Folder, there is no modified PSR4 Standard anymore. The namespace After the src folder is the same
as the File System Path. There is also a Adress and EmailAdress Class to show how inheritance is done.
Some field types cannot be detected automatically, like a normal DropdownField or EmailField. 
To change the FieldType, you override the setDefaultFieldTypes, and after the parent::setDefaultFieldTypes is called,
you change the fieldType to the one you like. The keys in the fieldTypes array are the sql field names.
```php
    <?php
    class EmailAddress extends \Concrete\Package\BasicTablePackage\Src\BaseEntity {
        //...some class code
    public function setDefaultFieldTypes()
        {
            parent::setDefaultFieldTypes(); // TODO: Change the autogenerated stub
            $this->fieldTypes['email'] = new EmailField('email', 'Email Address','postemail');//TODO change not automatically detected fieldtypes to the right fieldtype
    
        }
        //.. some class code
     }
```
2. To implement a DropdownField, define constants which hold the options:
  ```php
     <?php
     class Example extends \Concrete\Package\BasicTablePackage\Src\BaseEntity {
         //...some class code
         /**
          * @Column(type="string")
          */
         protected $dropdownfield;
     
         const DROPDOWNFIELD_OTHER = 'other';
         const DROPDOWNFIELD_RECIEVABLE = 'recievable';
         const DROPDOWNFIELD_PAYABLE = 'payable';
         const DROPDOWNFIELD_LIQUIDITY = 'liquidity';
         //.. some class code
         
         //and then in setDefaultFieldTypes, put the following code:
         public function setDefaultFieldTypes()
             {
                 //..some function code
                 //To implement a dropdownfield, do like this:
                 //this code reads the constans and puts them as options to the field
                 //if you add an option, it is automatically added to the field
                 $this->fieldTypes['dropdownfield']=new DropdownField('dropdownfield', 'Dropdownfield', 'postdropdownfield');
                 $refl = new \ReflectionClass($this);
                 $constants = $refl->getConstants();
                 $userConstants = array();
                 foreach($constants as $key => $value){
                     //if you have multiple dropdownfields, distinguish them somehow
                     if(strpos($value,"DROPDOWNFIELD")!==false) {
                         $userConstants[$value] = $value;
                     }
                 }
         
                 /**
                  * @var DropdownField
                  */
                 $this->fieldTypes['dropdownfield']->setOptions($userConstants);
                //..some function code here
         
         
             }
      }
 ```
 2. To Convert a Single Valued Association (OneToOne and ManyToOne) into a DirectEditAssociatedEntityField
 (A Field where you can choose the Associated Entity and directly create a new one or edit the old one), convert it like this:
   ```php
      <?php
      class Example extends \Concrete\Package\BasicTablePackage\Src\BaseEntity {
          //...some class code
          /**
               * @var Example
               * @ManyToOne(targetEntity="Concrete\Package\BaclucExampleBasicTablePackage\Src\Example", inversedBy="OneToMany")
               */
           protected $ManyToOne;
          //.. some class code
          
          //and then in setDefaultFieldTypes, put the following code:
          public function setDefaultFieldTypes()
              {
                  //..some function code
                  /**
                   * @var DropdownMultilinkField $addresses
                   * //TODO if you want to convert a field to a DirectEditAssociatedEntityMultipleField or DirectEditAssociatedEntityField
                   * do it like this
                   */
                  $oldField = $this->fieldTypes['ManyToOne'];
                  $directEditField = new \Concrete\Package\BasicTablePackage\Src\FieldTypes\DirectEditAssociatedEntityField($oldField->getSQLFieldName(), "ManyToOne", $oldField->getPostName());
                  \Concrete\Package\BasicTablePackage\Src\FieldTypes\DropdownLinkField::copyLinkInfo($oldField,$directEditField);
                  $this->fieldTypes['ManyToOne']=$directEditField;
                 //..some function code here
          
          
              }
       }
  ```
2. To Convert a Collection Valued Association (ManyToMany and OneToMany) into a DirectEditAssociatedEntityMultipleField
(A Field where you can choose the Associated Entity and directly create a new one or edit the old one, but multiple times), convert it like this:
  ```php
     <?php
     class Example extends \Concrete\Package\BasicTablePackage\Src\BaseEntity {
         //...some class code
         /**
              * @var Example[]
              * @OneToMany(targetEntity="Concrete\Package\BaclucExampleBasicTablePackage\Src\Example", mappedBy="ManyToOne")
              */
          protected $OneToMany;
         //.. some class code
         
         //and then in setDefaultFieldTypes, put the following code:
         public function setDefaultFieldTypes()
             {
                 //..some function code
                 /**
                  * @var DropdownMultilinkField $oldField
                  * //TODO if you want to convert a field to a DirectEditAssociatedEntityMultipleField or DirectEditAssociatedEntityField
                  * do it like this
                  */
                 $oldField = $this->fieldTypes['OneToMany'];
                 $directEditField = new \Concrete\Package\BasicTablePackage\Src\FieldTypes\DirectEditAssociatedEntityMultipleField($oldField->getSQLFieldName(), "ManyToOne", $oldField->getPostName());
                 \Concrete\Package\BasicTablePackage\Src\FieldTypes\DropdownLinkField::copyLinkInfo($oldField,$directEditField);
                 $this->fieldTypes['OneToMany']=$directEditField;
                //..some function code here
         
         
             }
      }
 ```
3.  The labels for the table header row and the form fields are by default the sql field name.
To change this, you can call in the same function the setLabel() function of the Field
  ```php
     <?php
     class Example extends \Concrete\Package\BasicTablePackage\Src\BaseEntity {
         //...some class code
     public function setDefaultFieldTypes()
         {
             parent::setDefaultFieldTypes(); 
             /*TODO to change the labels of the fields, to it like this.
                     as default, the name of the sql column is taken
                     */
              $this->fieldTypes['stringcolumn']->setLabel("Label changed to String");
     
         }
         //.. some class code
      }
 ```
4. If you want that the form fields don't look like the standard (always a linebreak between the fields),
You can define your own EntityView. To do that, create a class which extends AbstractFormView in src/EntityViews
and implement the method getFormView($form, $clientSideValidationActivated=true).  
An Example is in [src/EntityViews/EmailAddressFormView.php](src/EntityViews/EmailAddressFormView.php).
Then in your Entity, override the method. You define a FormView, and if you want a special 
View if it is shown in a DirectEditAssociationEntityField, you set the $this->defaultSubFormView.
 ```php
    <?php
    class EmailAddress extends \Concrete\Package\BasicTablePackage\Src\BaseEntity {
        //...some class code
      public function setDefaultFormViews()
        {
            $this->defaultFormView = new EmailAddressFormView($this);//TODO if you have a special form view for this entity, put it here
            $this->defaultSubFormView = new EmailAddressSubFormView($this);//TODO if you have a special form view for subform for this entity, put it here
        }
        //.. some class code
     }
```
5. When you finished implementing your Entities, remove the unnessesary ones and make your first test.
Install the Package and look if the SQL Tables are generated right.  
**<Important:>**  
Before you change anything about
* the columns
* the table name of the entity
* the classname
* discriminatorvalue  
you have to first uninstall the package, apply your changes, and then install it again.
Else you have some Exceptions like columnnotfoundexception and so on
**<\/Important>**  
6. Advanced Usage:  
If you want a default Filter for your Entity, you can set YourClassname::$staticEntityfilterfunction.
It applies mostly everywhere your entity is queried. This is not a senseful example because it has no
effect (intcolumn = 1 OR NOT intcolumn = 1), testso you have to use another query. You have to change Example:: to YourClassname::
```php
<?php
 /**
 * @param \Doctrine\ORM\QueryBuilder $query
 * @param array $queryConfig
 *  array of:
 * array(
 *'fromEntityStart' => array('shortname'=> 'e0'
 *                                                       , 'class'=>get_class($this->model)
 *                                             )
 *       ,'firstAssociationFieldname'=> array('shortname' => 'e1'
 *                                                                           , 'class' => 'Namespace\To\Entity\Classname')
 *
 * );
 * @return QueryBuilder

 *
 * @return QueryBuilder
 * TODO apply entity default filter
 */
Example::$staticEntityfilterfunction = function(QueryBuilder $query, array $queryConfig = array()){
    $firstEntityName = $queryConfig['fromEntityStart']['shortname'];

    //make complex query, for more see doctrine dok
    $query->andWhere(
        $query->expr()->orX(
            $query->expr()->eq($firstEntityName.".intcolumn", ":ExampleProductintcolumn")
            ,
            $query->expr()->neq($firstEntityName.".intcolumn", ":ExampleProductintcolumn")
        )


    );
    $query->setParameter(":ExampleProductintcolumn", 1);

    return $query;
};
```
7. If you finished implementing your Entities, you uninstall the package and implement your BlockType
To do that, you copy the folder blocks/bacluc_example_block and change the name of the new folder.
Then, you have to change controller.php. Again, here are TODO comments everywhere you have to change something
8. If you finished implementing your BlockType, you can uncomment the line which installs the BlockType in your Package Controller,
install the package again and look if everything works.
9. Advanced usage:  
You can edit every point of the functionality of the basic_table_block_packaged. You can change
what happens after a new row is submitted, you can add new actions and even more. How to to this is
shown in the commentet lines after the function getBlockTypeName()
10. Javascript and CSS
view.css, auto.js, the javascript files in the js/* folder and the css files in css/* folder are automatically loaded.
If you want to be sure that everything is loaded correctly, you have to override 
the on_start and registerViewAssets function. If you want certain javascript available in your add the block form,
you have to override the add method. don't forget to first call the parent method.
If you add a less file with $al->register, it is compiled by concrete5 automatically
 ```php
    <?php
    class Controller extends \Concrete\Package\BasicTablePackage\Block\BasicTableBlockPackaged\Controller  {
        //...some class code
      


    /**
     * list needed javascript/css files
 *     */
   public function on_start()
    {
          parent::on_start();
        $package = Package::getByHandle("basic_table_package");
        $al = \Concrete\Core\Asset\AssetList::getInstance();

        $al->register(
            'javascript', 'autojs', 'blocks/basic_table_block_packaged/js/auto.js',
            array('minify' => false, 'combine' => true)
            , $package
        );

        $groupAssets = array(
            array('javascript', 'autojs'),
        );


        $al->registerGroup('example', $groupAssets);

    }

    /**
     * register needed javascript
     */
    public function registerViewAssets($outputContent = '')
    {
      parent::registerViewAssets($outputContent);
        $this->requireAsset('example');
    }

    /**
     * register also for add form
     */
    public function add()
    {
      parent::add();
        $this->requireAsset('example');
    }
        //.. some class code
     }
```
